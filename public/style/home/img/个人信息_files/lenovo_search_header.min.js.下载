function getQueryString(a){var b=new RegExp("(^|&)"+a+"=([^&]*)(&|$)","i"),c=window.location.search.substr(1).match(b);return null!=c?decodeURIComponent(c[2]):""}function getLeid(){for(var a="",b=document.cookie.split(";"),c=0;c<b.length;c++)if("leid"==b[c].split("=")[0].trim()){a=b[c].split("=")[1];break}return a}function checkisMachineNo(a){a=$.trim(a);var b=$.trim(a);return""==b.replace(/[0-9a-z]/gi,"")&&((8==b.length||10==b.length||14==b.length||18==b.length)&&"thinkpad"!=b.toLowerCase())}function plugin0(){return document.getElementById("plugin0")}function addEvent(a,b,c){window.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c)}function load(){addEvent(plugin(),"test",function(){alert("Received a test event from the plugin.")})}function pluginLoaded(){try{return plugin().getMachineNum()}catch(a){return!1}}function addTestEvent(){addEvent(plugin(),"echo",function(a,b){alert(a+b)})}function testEvent(){plugin().testEvent()}function pluginValid(){plugin().valid?alert(plugin().echo("This plugin seems to be working!")):alert("Plugin is not working :(")}function autoAjax(a,b){$.ajax({url:tmp_search_url+"/search/suggest?kw="+encodeURIComponent($(".think_search_header input[type=text]").val())+"&plat=4&leid="+getLeid(),type:"GET",jsonp:"cb",dataType:"jsonp",success:function(a){if("1"!=a.rc){var c=["<ul>"];if(0!=a.s.length){b.suggest.html("");for(var d=a.s,e=0;e<d.length;e++)"cate"==d[e].type?c.push("<li class='apperceive_item' title='"+d[e].word+"'><a href='"+tmp_search_url+"?index="+d[e].code+"&key="+d[e].word+"'  class='left_item' >"+d[e].word+"</a><a class='right_item' href='jajvascript://'>约"+d[e].resultCount+"个商品</a></li>"):"goods"==d[e].type?c.push("<li class='apperceive_item' title='"+d[e].word+"'><a href='"+tmp_lenovo_detail+d[e].code+".html?key="+d[e].word+"' class='left_item'>"+d[e].word+"</a><a class='right_item' href='jajvascript://'>约"+d[e].resultCount+"个商品</a></li>"):"1"==d[e].his?getQueryString("index")?checkisMachineNo(d[e].word)&&"lenovo"!=channelType?c.push("<li class='history_item' title='"+d[e].word+"'><a class='left_item' href='"+tmp_search_url+"/service_index.html?machineno="+d[e].word+"'>"+d[e].word+"</a><a class='right_item del' word='"+d[e].word+"' tag='del'>删除</a><a class='right_item' href='jajvascript://'>历史记录</a></li>"):c.push("<li class='history_item' title='"+d[e].word+"'><a class='left_item' href='"+tmp_search_url+"?key="+d[e].word+"'>"+d[e].word+"</a><a class='right_item del' word='"+d[e].word+"' tag='del'>删除</a><a class='right_item' href='jajvascript://'>历史记录</a></li>"):checkisMachineNo(d[e].word)&&"lenovo"!=channelType?c.push("<li class='history_item' title='"+d[e].word+"'><a class='left_item' href='"+tmp_search_url+"/service_index.html?machineno="+d[e].word+"'>"+d[e].word+"</a><a class='right_item del' word='"+d[e].word+"' tag='del'>删除</a><a class='right_item' href='jajvascript://'>历史记录</a></li>"):c.push("<li class='history_item' title='"+d[e].word+"'><a class='left_item' href='"+tmp_search_url+"?key="+d[e].word+"'>"+d[e].word+"</a><a class='right_item del' word='"+d[e].word+"' tag='del'>删除</a><a class='right_item' href='jajvascript://'>历史记录</a></li>"):getQueryString("index")?c.push("<li class='apperceive_item' title='"+d[e].word+"'><a href='"+tmp_search_url+"?key="+d[e].word+"' class='left_item'>"+d[e].word+"</a><a class='right_item' href='jajvascript://'>约"+d[e].resultCount+"个商品</a></li>"):c.push("<li class='apperceive_item' title='"+d[e].word+"'><a href='"+tmp_search_url+"?key="+d[e].word+"' class='left_item'>"+d[e].word+"</a><a class='right_item' href='jajvascript://'>约"+d[e].resultCount+"个商品</a></li>");c.push("</ul>"),b.suggest.html(c.join("")).show(),current_index=0}}}})}function getItemsInAutoCompletedList(a){var b=null;return $("#suggestContainer a").each(function(){if($(this).text().trim().toLowerCase()==a.trim().toLowerCase())return b=$(this),!1}),b}function setQuDongKeyWord(a){for(var b=["显卡驱动","无线网卡驱动","网卡驱动","声卡驱动","显卡驱动","驱动下载","驱动","蓝牙驱动","键盘驱动","触摸板驱动","打印机驱动","电源管理驱动","电源驱动"],c=0;c<b.length;c++)if(a.toLowerCase()==b[c].toLowerCase()){window.open("http://support1.lenovo.com.cn/lenovo/wsi/Modules/NewDrive.aspx");break}}var tmp_search_url="http://s.lenovo.com.cn",tmp_think_detail="http://www.thinkworldshop.com.cn/pm/",tmp_lenovo_detail="http://www.lenovo.com.cn/product/";String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")},plugin=plugin0;var current_index=1;AutoComplete.constructor=function(a){var b,c="oninput"in window?"input":"keyup";if(this.tip=a.tip||getQueryString("key")?getQueryString("key"):"",this.input=a.input,this.input){if(this.input.val(this.tip),this.form=a.form,!this.form&&(b=this.input.parents("form"))&&b.length&&(this.form=b,b=null),this.submit=a.submit||this.submit,this.getDatas=a.getDatas||this.getDatas,this.suggest=a.suggest,!this.suggest){var d=document.createElement("div"),e=getPosition(this.input[0],"offsetLeft"),f=getPosition(this.input[0],"offsetTop")+this.input.height();d.style.cssText="position:absolute;top:"+f+"px;left:"+e+"px",document.body.appendChild(d),this.suggest=jQuery(d)}this.suggest.hide(),this.list=(a.list||"li").toLowerCase(),this.hover=a.hover||"hover",this.input.focus(jQuery.proxy(this.focus,this)),this.input.blur(jQuery.proxy(this.blur,this)),this.input.keydown(jQuery.proxy(this.keydown,this)),this.input.bind(c,jQuery.proxy(this.textInput,this)),this.form&&this.form.bind("submit",jQuery.proxy(this.submit,this)),this.suggest.delegate(this.list,"mouseover",jQuery.proxy(this.mouseover,this)),this.suggest.delegate(this.list,"click",jQuery.proxy(this.click,this))}},AutoComplete.prototype.keydown=function(a){var b=a.keyCode,c=this.list,d=this.hover;if(b>=37&&b<=40){if(!this.suggest.find(c).length)return;a.preventDefault(),0==current_index&&(this.current=null),this.suggest.find(c).removeClass(d).removeClass("activity"),37==b||38==b?this.current=this.current&&this.current.prev().length?this.current.prev():this.suggest.find(c).last():this.current=this.current&&this.current.next().length?this.current.next():this.suggest.find(c).first(),this.current.addClass(d),this.setInputValue()}else 13==b&&(this.form||this.submit());current_index=1};var channelType=$("#searchkey")&&$.trim($("#searchkey").val()).length>0?$("#searchkey").val():"default",defaultKey="",searchAuto=Class.create({setInputValue:function(){var a;this.current&&(a=this.current.attr("title")||this.current.text(),this.input.val(a))},focus:function(){var a=this;$(".think_search_header ul").hide();var b=$(".think_search_header input[type=text]").val();b==defaultKey||""==b?($(".think_search_header input[type=text]").val(""),autoAjax("",a)):autoAjax(b,a)},blur:function(){},click:function(a){var b=a.target;if("del"!=$(b).attr("tag"))return this.input.val($(b).parent().attr("title")),!0;var c=$(b).attr("word");$.ajax({url:tmp_search_url+"/search/suggestDelete?kw="+encodeURIComponent(c)+"&plat=4&leid="+getLeid()+"&ran="+Math.random(),type:"GET",jsonp:"cb",dataType:"jsonp",success:function(a){"0"==a.rc&&$(b).parent().remove()}}),a.stopPropagation()}},AutoComplete),commonSearch=function(){var a=this;this.current=$("#suggestContainer li:eq(0)"),this.channelType=$("#searchkey")&&$.trim($("#searchkey").val()).length>0?$("#searchkey").val():"default",this.snReader=null,this.init=function(){a.setSearchTextPlaceHolder(),a.setKeyWord(),this.regGetHotWords(),a.regEvent()},this.regEvent=function(){a.regChkeckService(),a.regContainerListMouseover(),a.regDelKeywordsHover(),a.regSearchButtonClick(),a.regBodyClick(),a.regSearchLiClick(),a.regSearchBtnHover(),a.regGetMachineNo(),a.regGoHaoGetMachineNo()},this.regChkeckService=function(){"server"==a.channelType?$(".search_box .btn_get_machineno,.search_box .btn_haoget_machineno").show():$(".search_box .btn_get_machineno,.search_box .btn_haoget_machineno").hide()},this.regGoHaoGetMachineNo=function(){$(document).delegate("#btn_haoget_machineno","click",function(){window.open(tmp_search_url+"/getmachine_no.html")})},this.regGetMachineNo=function(){$(document).delegate("a.btn_get_machineno","click",function(){a.checkValue($(".search_box input[latag=latag_pc_search_keyword]"),7)})},this.checkValue=function(a,b){if(!(window.ActiveXObject||"ActiveXObject"in window))return void alert("抱歉，此功能目前只在IE浏览器下可用！");if(load(),pluginLoaded())setTimeout(function(){var b=pluginLoaded();if("undefined"!=typeof b&&b.length>7)try{a.val(b)}catch(c){parent.window==self.window?alert("主机编号未能正确识别"):alert("主机编号未能正确识别")}else parent.window==self.window?alert("主机编号未能正确识别"):alert("主机编号未能正确识别")},10);else{if(navigator.userAgent.toLowerCase().indexOf("firefox/3")!=-1)return void alert("自动获取主机编号软件不支持火狐浏览器，建议使用IE浏览器安装此软件");var c=parent.document.URL;parent.window==self.window?window.location.href=tmp_search_url+"/sn_readner_install.html?strurl="+c:window.open(tmp_search_url+"/sn_readner_install.html?strurl=window.close","sn")}},this.regSearchBtnHover=function(){$("a.serch_box_img").hover(function(){$(".search_box input").addClass("activity")},function(){$(".search_box input").removeClass("activity")})},this.regGetHotWords=function(){var b="http://s.lenovo.com.cn?key=",c="http://s.lenovo.com.cn/search/selCHannelHotWords?key="+a.channelType;document.URL.indexOf("lenovouat")>-1&&(b="http://s.lenovouat.cn?key=",c="http://s.lenovouat.cn/search/selCHannelHotWords?key="+a.channelType);var d="";$.ajax({url:c,jsonp:"cb",dataType:"jsonp",success:function(a){if("0"==a.rc){if(a.keywords.length>0)for(var c=0;c<a.keywords.length;c++)d+="<li><a href='"+b+a.keywords[c]+"'>"+a.keywords[c]+"</a></li>";$(".search_box ul.resou_keyword").html(d)}},error:function(){}})},this.regSearchLiClick=function(){$("#suggestContainer").delegate("li","click",function(){var a=event.target;"del"==$(a).attr("tag")||(""!=$.trim($(this).find("a.left_item").html())&&setQuDongKeyWord($(this).find("a.left_item").html()),window.location.href=$(this).find("a.left_item").attr("href"))})},this.setKeyWord=function(){getQueryString("key")?($(".think_search_header input[type=text]").val(getQueryString("key")),$(".think_search_header ul").hide()):($(".think_search_header input[type=text]").val(""),$(".think_search_header ul").show())},this.setSearchTextPlaceHolder=function(){var b="http://s.lenovo.com.cn/search/getDefaultHotword?platType=1&channelType="+a.channelType;document.URL.indexOf("lenovouat")>-1&&(b="http://s.lenovouat.cn/search/getDefaultHotword?platType=1&channelType="+a.channelType),$.ajax({url:b,jsonp:"cb",async:!1,dataType:"jsonp",success:function(a){"0"==a.rc&&($(".think_search_header input[type=text]").attr("placeholder",a.keyword),$(".think_search_header input[type=text]").attr("placeholder-url",a.url))},error:function(){}})},this.regContainerListMouseover=function(){$("#suggestContainer").delegate("li","mouseover",function(){$(this).addClass("activity")}),$("#suggestContainer").delegate("li","mouseout",function(){$(this).removeClass("activity")})},this.regDelKeywordsHover=function(){$(".search_box").delegate("i","mouseover",function(){$(this).addClass("activity")}),$(".search_box").delegate("i","mouseout",function(){$(this).removeClass("activity")})},this.regSearchButtonClick=function(){$("body").delegate(".think_search_header a[tag=searchButton]","click",function(){var b=$(this).next().val();if(checkisMachineNo(b)&&"lenovo"!=a.channelType)window.location.href=tmp_search_url+"/service_index.html?machineno="+b;else{var c=$(".think_search_header input[type=text]").attr("placeholder")?$(".think_search_header input[type=text]").attr("placeholder"):"",d=$(".think_search_header input[type=text]").attr("placeholder-url")?$(".think_search_header input[type=text]").attr("placeholder-url"):"";b==defaultKey&&(b="");var e=getItemsInAutoCompletedList(b),f=getQueryString("index");""==b&&(f=-1),e?window.location.href=e.attr("href"):""==b?""!=d?window.open(d):window.location.href=tmp_search_url+"?key="+encodeURIComponent(c):(setQuDongKeyWord(b),f>-1?window.location.href=tmp_search_url+"?key="+encodeURIComponent(b):window.location.href=tmp_search_url+"?key="+encodeURIComponent(b))}})},this.regBodyClick=function(){$("body").click(function(a){var b=$(a.target);if("latag_pc_search_keyword"==b.attr("latag")){var c=$(".think_search_header input[type=text]").val();""==$.trim(c)?$(".think_search_header i").hide():$(".think_search_header i").show(),$(".search_box ul.resou_keyword").hide();var d={input:$(".think_search_header input[type=text]"),suggest:$("#suggestContainer"),tip:getQueryString("key")?" ":defaultKey};autoAjax("",d)}else if("del"==b.attr("tag"))$("#suggestContainer").show();else if("remove_keyword"==b.attr("id")){$(".think_search_header input[type=text]").val("");var d={input:$(".think_search_header input[type=text]"),suggest:$("#suggestContainer"),tip:getQueryString("key")?" ":defaultKey};autoAjax("",d)}else""==$(".think_search_header input[type=text]").val()?($(".think_search_header ul").show(),$(".think_search_header input[type=text]").val(defaultKey)):$(".think_search_header input[type=text]").val()==defaultKey?$(".think_search_header ul").show():$(".think_search_header ul").hide(),$("#suggestContainer").hide()})}};$(function(){var a=new commonSearch;a.init();var b=1;new searchAuto({input:$(".think_search_header input[type=text]"),suggest:$("#suggestContainer"),tip:getQueryString("key")?" ":defaultKey,getDatas:function(a){var c=this,d=$.trim($(".think_search_header input[type=text]").val());""==$.trim(d)?$(".think_search_header i").hide():$(".think_search_header i").show(),0==b&&autoAjax(d,c),b=0},submit:function(){this.suggest.hide();var a=$(".think_search_header input[type=text]").val();if(checkisMachineNo(a)&&"lenovo"!=channelType)window.location.href=tmp_search_url+"/service_index.html?machineno="+a;else{var b=$(".think_search_header input[type=text]").attr("placeholder")?$(".think_search_header input[type=text]").attr("placeholder"):"",c=$(".think_search_header input[type=text]").attr("placeholder-url")?$(".think_search_header input[type=text]").attr("placeholder-url"):"";a==defaultKey&&(a="");var d=getItemsInAutoCompletedList(a),e=getQueryString("index");""==a&&(e=-1),d?window.location.href=d.attr("href"):""==a?""!=c?window.open(c):window.location.href=tmp_search_url+"?key="+encodeURIComponent(b):(setQuDongKeyWord(a),e>-1?window.location.href=tmp_search_url+"?key="+encodeURIComponent(a):window.location.href=tmp_search_url+"?key="+encodeURIComponent(a))}}})});